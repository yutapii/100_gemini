# Gemini品質検査マニュアル

**作成日**: 2026-02-06
**対象**: Claude Code成果物の品質検査
**検査AI**: Gemini 2.5 Flash
**現在の検査基準**: v1.1

---

## 📋 バージョン履歴

| バージョン | 日付 | 変更内容 | 項目数 |
|-----------|------|----------|--------|
| **v1.2** | 2026-02-06 | 証跡重視+Claude再点検追加（ハルシネーション防止） | 🔴5 🟡4 🟢4（計13） |
| **v1.1** | 2026-02-06 | コンソールエラーゼロを🔴必須に追加 | 🔴5 🟡4 🟢4（計13） |
| **v1.0** | 2026-02-06 | 初期版 | 🔴4 🟡4 🟢4（計12） |

**バージョン命名規則:**
- 検査実行時に `yyMMddHHmm` 形式で自動生成
- 例: `v2602061430` = 2026年02月06日14時30分

**v1.2の重要変更:**
- **証跡重視**: 全コマンド実行結果を記録
- **ダブルチェック**: Claude Codeが再点検
- **ハルシネーション防止**: 推測禁止、実測必須
- **モデル指定**: Flash-Lite禁止、Flash/Pro推奨

---

## 🎯 検査実行コマンド

```bash
cd ~/100_gemini && gemini "品質検査マニュアルに従ってClaude Code成果を検査"
```

**重要:** 検査開始時に必ず検査バージョン（v[yyMMddHHmm]）を記録すること

---

## ⚠️ 証跡重視検査（v1.2〜：ハルシネーション防止）

### 背景

**2026-02-06の誤検査事例:**
- Gemini報告: index.html = 11行
- 実際: index.html = 957行
- **誤差: 87倍**

**原因:**
- ツールを実行せず推測で回答
- 別ファイルと混同
- 確証バイアス

### 対策：証跡重視検査

**全ての検査項目について、以下の形式で記録必須:**

```
■ 検査項目X: [項目名]
実行コマンド: [実際に実行したコマンド]
実行結果: [コマンドの出力結果]
判定根拠: [結果から導いた判定理由]
判定: ✅合格/❌不合格/⚠️懸念
```

**例:**
```
■ 検査項目2: 500行/ファイル制約
実行コマンド: wc -l *.html *.js *.css
実行結果:
     957 index.html
     875 main.js
    1132 style.css
    2964 total
判定根拠: 全ファイルが500行を超過
判定: ❌ 不合格
```

### 禁止事項

❌ **推測・記憶に頼った回答**
❌ **ツール実行なしの報告**
❌ **「おそらく」「推定」等の曖昧表現**
❌ **根拠なき数値の記載**

✅ **全てツールで実測**
✅ **コマンドと結果を記録**
✅ **不明な場合は「検証不可」と明記**

---

## 🔄 Claude Code再点検プロセス（v1.2〜）

### ダブルチェック体制

```
第1段階：Gemini検査（証跡重視）
    ↓
第2段階：Claude Code再点検
    ↓
最終報告（誤差分析付き）
```

### 再点検手順

#### ステップ1：Gemini報告書の読み込み

```bash
# Gemini検査結果を確認
cat ~/100_gemini/020_work_reports/YYYYMMDD_HHmm_xxx_gemini_vXX.md
```

#### ステップ2：重要項目の再実行

```bash
# 必須再点検項目
cd [対象ディレクトリ]

# 1. 行数確認
wc -l *.html *.js *.css

# 2. 80文字超過確認
awk 'length > 80 {print FILENAME":"NR": "length}' *.html *.js *.css | wc -l

# 3. XSS確認
grep -n "innerHTML\|eval(" *.js

# 4. グローバル変数確認
grep -n "^let \|^var \|^const " *.js | wc -l
```

#### ステップ3：誤差分析

```
検査項目: 500行/ファイル制約
Gemini報告: index.html=11行, main.js=113行, style.css=65行
Claude検証: index.html=957行, main.js=875行, style.css=1132行
誤差: index.html=87倍, main.js=7.7倍, style.css=17倍
原因: ツール未実行、推測回答
信頼性: 低
最終判定: ❌ 不合格（Gemini報告は無効）
```

#### ステップ4：最終報告作成

**ファイル名:**
```
YYYYMMDD_HHmm_[件名]_final_v[yyMMddHHmm].md
```

**内容:**
1. Gemini検査結果
2. Claude検証結果
3. 誤差分析
4. 信頼性評価
5. 最終判定
6. 改善策

### 信頼性評価基準

| 信頼性 | 誤差範囲 | 評価 |
|--------|---------|------|
| **高** | ±5%以内 | Gemini報告を採用 |
| **中** | ±20%以内 | Claude検証を優先 |
| **低** | ±20%超 | Gemini報告を無効、Claude判定のみ |

---

## 📊 検査品質の保証

### Gemini側の責任

- [ ] 全コマンドを実行
- [ ] 実行結果を記録
- [ ] 推測ゼロ
- [ ] 不明点を明記

### Claude Code側の責任

- [ ] Gemini報告を検証
- [ ] 重要項目を再実行
- [ ] 誤差を分析
- [ ] 最終判定を下す

### 相互補完

| 項目 | Gemini | Claude Code |
|------|--------|-------------|
| **初回検査** | ⭐ 全13項目を網羅 | - |
| **証跡記録** | ⭐ コマンド+結果 | - |
| **再検証** | - | ⭐ 重要項目を再実行 |
| **誤差分析** | - | ⭐ 統計的評価 |
| **最終判定** | - | ⭐ 権限あり |

**両者の協力により、ハルシネーションを検出・排除し、高品質な検査を実現。**

---

## 📋 検査項目（階層化）

### 🔴 必須検査（不合格なら即NG）

**1つでもNGなら❌不合格**

| No | 項目 | 検査内容 | 合格基準 |
|----|------|----------|----------|
| 1 | **80文字/行制約** | 全ファイルの全行を確認 | 超過0行 |
| 2 | **500行/ファイル制約** | 全ファイルの行数確認 | 超過0ファイル |
| 3 | **XSS脆弱性** | innerHTML、eval、document.write等 | 検出0件 |
| 4 | **機密情報漏洩** | パスワード、APIキー、トークン等 | 検出0件 |
| 5 | **コンソールエラーゼロ** | JS実行時エラー、undefined参照等 | エラー0件 |

**検査ツール:**
```bash
# 80文字超過チェック
awk 'length > 80 {print FILENAME":"NR": "length" chars"}' **/*.{js,html,css,py}

# 500行超過チェック
find . -type f \( -name "*.js" -o -name "*.html" -o -name "*.css" -o -name "*.py" \) -exec wc -l {} \; | awk '$1 > 500 {print}'

# XSSリスク検出
grep -rn "innerHTML\|eval(" **/*.js

# 機密情報検出
grep -rn "password\|api_key\|token\|secret" --include="*.{js,py,html}"

# コンソールエラーチェック（ブラウザで実行）
# 1. ブラウザのDevToolsを開く（F12）
# 2. Consoleタブを確認
# 3. エラー（赤色）がないことを確認
# 4. 警告（黄色）も可能な限り解消
```

---

### 🟡 重要検査（減点対象）

**NGがあると減点、Grade C以下**

| No | 項目 | 検査内容 | 許容範囲 |
|----|------|----------|----------|
| 6 | **セマンティックHTML** | div/span乱用チェック | 適切なタグ使用率80%以上 |
| 7 | **グローバル変数** | JSグローバル変数の数 | 5個以下 |
| 8 | **コード重複** | 同一コードブロックの重複 | 重複率10%以下 |
| 9 | **アクセシビリティ** | ARIA属性、alt属性の有無 | 必須要素100%対応 |

**検査ポイント:**
- `<div>`だらけ → `<section>`, `<article>`, `<nav>` 等を使うべき
- `var`宣言のグローバル変数 → `const`, `let`でスコープ制限
- 同じコードが3回以上 → 関数化すべき
- `<img>`に`alt`なし → アクセシビリティ違反

---

### 🟢 推奨検査（改善推奨）

**NGでも合格、改善提案として記載**

| No | 項目 | 検査内容 | 推奨基準 |
|----|------|----------|----------|
| 10 | **コメント充実度** | 複雑なロジックへのコメント | 関数に説明コメント |
| 11 | **命名規則の統一** | camelCase/snake_caseの混在 | プロジェクト内統一 |
| 12 | **CSSハードコーディング** | 色、サイズの直書き | 変数化率80%以上 |
| 13 | **コントラスト比** | WCAG 2.1準拠（4.5:1以上） | AA基準クリア |

**改善例:**
```javascript
// ❌ 悪い例
function calc(x) { return x * 2; }  // コメントなし
var mainColor = "#ff5733";  // ハードコーディング

// ✅ 良い例
/**
 * 入力値を2倍にする（税込計算用）
 */
function calculateDouble(value) {
    return value * 2;
}
const THEME_PRIMARY_COLOR = "#ff5733";
```

---

## 📊 出力形式

### 1. 合否判定

```
【検査バージョン】v2602061430 (2026-02-06 14:30実行)
検査基準: v1.1 (🔴5 🟡4 🟢4 計13項目)

【判定】
🔴 必須検査: 5項目中 5項目合格 ✅
🟡 重要検査: 4項目中 3項目合格 ⚠️
🟢 推奨検査: 4項目中 2項目合格 📝

【総合判定】✅ 合格（Grade B）
```

**Grade基準:**
- Grade A: 🔴全合格 + 🟡全合格 + 🟢全合格
- Grade B: 🔴全合格 + 🟡全合格
- Grade C: 🔴全合格 + 🟡一部不合格
- Grade D: 🔴全合格 + 🟡大半不合格
- Grade F: 🔴1つでも不合格

---

### 2. 🤖 Gemini寸評

```
【Geminiの限界】
- 動的テスト不可（実際のサーバー起動・ブラウザ確認不能）
- ワークスペース外ファイルアクセス制約
- API容量制限による中断リスク

【Geminiの強み】
- 80文字制約の厳格チェック（文字数カウント精度高）
- セキュリティリスクのパターン検出
- コード重複の自動検出
- 複数ファイルの横断分析
```

---

### 3. 📊 検査・修正数

```
【統計】
- 検査項目総数: 13項目
- 🔴必須: 5項目（合格5、不合格0）
- 🟡重要: 4項目（合格3、不合格1）
- 🟢推奨: 4項目（合格2、不合格2）
- 問題発見数: 3件
- 要修正箇所: 1件（必須）、2件（推奨）
```

---

### 4. 📝 改善策（不合格時）

**🔴必須項目が不合格の場合：**
```
【緊急修正必須】
1. 80文字超過: index.html 870行目（98文字）
   → 57文字に短縮（省略形使用）

2. XSS脆弱性: main.js 45行目
   → innerHTML → textContent に変更
```

**🟡重要項目が不合格の場合：**
```
【改善推奨（Grade向上のため）】
3. グローバル変数: main.js に8個
   → IIFE または モジュール化で5個以下に削減
```

**🟢推奨項目が不合格の場合：**
```
【今後の改善案】
4. CSSハードコーディング: style.css 全体
   → CSS変数（--primary-color等）に置換
```

---

## 💾 記録先（カーボンコピー）

検査完了後、以下の2箇所に同じ内容を保存：

```
1. 検査側（Gemini）
   ~/100_gemini/020_work_reports/YYYYMMDD_HHmm_[件名]_v[yyMMddHHmm].md

2. 被検査側（対象システム）
   ~/[対象システム]/020_work_reports/YYYYMMDD_HHmm_[件名]_v[yyMMddHHmm].md
```

**ファイル命名規則:**
```
YYYYMMDD_HHmm_[対象システム名]_inspection_v[yyMMddHHmm].md

例:
20260206_1430_stp_panel_inspection_v2602061430.md
20260206_1545_scf_main_inspection_v2602061545.md
```

**バージョン（v[yyMMddHHmm]）の意味:**
- 検査を実行した日時をバージョンとして記録
- 同じ対象を複数回検査した場合も、実行時刻で区別可能
- 検査基準の変更履歴も追跡可能

---

## 🔄 検査フロー

```
1. 検査実行
   ↓
2. 🔴必須検査（1つでもNG → 即❌不合格）
   ↓
3. 🟡重要検査（減点評価）
   ↓
4. 🟢推奨検査（改善提案）
   ↓
5. Grade判定（A～F）
   ↓
6. Gemini寸評記載
   ↓
7. 統計集計
   ↓
8. 改善策提示
   ↓
9. 両側にカーボンコピー記録
   ↓
10. 完了報告
```

---

## 🎯 運用ルール

### 検査タイミング

- ✅ **作業途中**: コミット前の自己チェック
- ✅ **作業終了時**: 最終品質確認
- ✅ **プルリク前**: レビュー依頼前の事前検査
- ✅ **定期検査**: 週次/月次の品質監査

### 検査範囲

**全ファイル検査:**
- `*.html` - HTMLファイル
- `*.js` - JavaScriptファイル
- `*.css` - CSSファイル
- `*.py` - Pythonファイル

**除外対象:**
- `node_modules/` - 外部ライブラリ
- `999_trash/` - ゴミ箱
- `*.min.js` - ミニファイ済み
- `*.min.css` - ミニファイ済み

---

## 📚 関連文書

- `/Users/saitoyutaka/010_STP_APIv1/080_tps/DIGITAL_CONSTRUCTION_5S.md`
- `/Users/saitoyutaka/070_claude-md-dev/080_ve_va_tps/AI_INSPECTION_QUALITY_CONTROL.md`
- `/Users/saitoyutaka/010_STP_APIv1/080_tps/quality_assurance.md`

---

## 結論

**🔴必須検査を絶対クリアせよ。🟡重要検査でGrade向上。🟢推奨検査で持続的改善。**
