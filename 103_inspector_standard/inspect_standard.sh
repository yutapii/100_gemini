#!/bin/bash
# inspect_standard.sh
# æ¨™æº–æ¤œæŸ»ï¼ˆFlash ğŸ’µğŸ’µğŸ’µï¼‰

set -euo pipefail

# å®šæ•°
readonly SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
readonly REPORTS_DIR="$SCRIPT_DIR/reports"
readonly EVIDENCE_DIR="${1:-}"
readonly TARGET_DIR="${2:-}"

# åˆæœŸåŒ–
mkdir -p "$REPORTS_DIR"

# å¼•æ•°ãƒã‚§ãƒƒã‚¯
if [[ -z "$EVIDENCE_DIR" ]] || [[ -z "$TARGET_DIR" ]]; then
    echo "ä½¿ã„æ–¹: $0 <è¨¼è·¡ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª> <å¯¾è±¡ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª>"
    exit 1
fi

# æ¨™æº–æ¤œæŸ»å®Ÿè¡Œ
run_standard_inspection() {
    local evidence_dir="$1"
    local target_dir="$2"
    local ts="$(date '+%Y%m%d_%H%M%S')"
    local report="$REPORTS_DIR/${ts}_standard.md"

    echo ""
    echo "ğŸ” æ¨™æº–æ¤œæŸ»é–‹å§‹ï¼ˆFlash ğŸ’µğŸ’µğŸ’µï¼‰"
    echo ""

    # ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆLevel 1 + é‡è¦4é …ç›®ï¼‰
    local prompt="
ã‚ãªãŸã¯å“è³ªæ¤œæŸ»AIã§ã™ã€‚è¨¼è·¡ãƒ­ã‚°ã‚’åˆ†æã—ã¦ãã ã•ã„ã€‚

ã€é‡è¦åŸå‰‡ã€‘
1. æ¨æ¸¬ç¦æ­¢ï¼šè¨¼è·¡ãƒ­ã‚°ã®äº‹å®Ÿã®ã¿ã‚’æ ¹æ‹ ã¨ã™ã‚‹
2. ã‚³ãƒãƒ³ãƒ‰æœªå®Ÿè¡Œæ™‚ï¼šã€Œè¨¼è·¡ãªã—ã€ã¨æ˜è¨˜
3. åˆæ ¼/ä¸åˆæ ¼ã‚’æ˜ç¢ºã«åˆ¤å®š
4. â˜…wc.logã®ã€Œtotalã€è¡Œã¯åˆè¨ˆå€¤ã€ãƒ•ã‚¡ã‚¤ãƒ«è¡Œæ•°ã§ã¯ãªã„

ã€æ¤œæŸ»é …ç›®ã€‘
1. 500è¡Œ/ãƒ•ã‚¡ã‚¤ãƒ«åˆ¶ç´„ï¼ˆå¿…é ˆï¼‰
2. 80æ–‡å­—/è¡Œåˆ¶ç´„ï¼ˆå¿…é ˆï¼‰
3. æ©Ÿå¯†æƒ…å ±æ¼æ´©ï¼ˆå¿…é ˆï¼‰
4. æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ï¼ˆå¿…é ˆï¼‰
5. é–¢æ•°åˆ†å‰²ï¼ˆå˜ä¸€è²¬ä»»ï¼‰
6. å¤‰æ•°å‘½åè¦å‰‡
7. ã‚³ãƒ¡ãƒ³ãƒˆå“è³ª
8. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
9. å†—é•·ã‚³ãƒ¼ãƒ‰æ¤œå‡º

ã€å‡ºåŠ›å½¢å¼ã€‘
## Level 2æ¤œæŸ»çµæœ

| é …ç›® | åˆ¤å®š | è¨¼è·¡ |
|------|------|------|
| 500è¡Œåˆ¶ç´„ | âœ…/âŒ | æœ€å¤§XXXè¡Œ |
| 80æ–‡å­—åˆ¶ç´„ | âœ…/âŒ | è¶…éXXè¡Œ |
| æ©Ÿå¯†æƒ…å ± | âœ…/âŒ | æ¤œå‡ºXXä»¶ |
| æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ | âœ…/âŒ | ã‚¨ãƒ©ãƒ¼XXä»¶ |
| é–¢æ•°åˆ†å‰² | âœ…/âŒ | è©•ä¾¡ |
| å¤‰æ•°å‘½å | âœ…/âŒ | è©•ä¾¡ |
| ã‚³ãƒ¡ãƒ³ãƒˆ | âœ…/âŒ | è©•ä¾¡ |
| ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° | âœ…/âŒ | è©•ä¾¡ |
| å†—é•·ã‚³ãƒ¼ãƒ‰ | âœ…/âŒ | è©•ä¾¡ |

**ç·åˆåˆ¤å®š**: âœ…åˆæ ¼ / âŒä¸åˆæ ¼
"

    # Geminiå®Ÿè¡Œ
    if cd "$target_dir" && \
        gemini --model "gemini-2.5-flash" \
        "$prompt" > "$report" 2>&1; then
        cat "$report"
        echo ""
        echo "âœ… Level 2æ¤œæŸ»å®Œäº†"
        echo "ãƒ¬ãƒãƒ¼ãƒˆ: $report"
        return 0
    else
        echo "âŒ Level 2æ¤œæŸ»å¤±æ•—"
        cat "$report"
        return 1
    fi
}

# å®Ÿè¡Œ
run_standard_inspection "$EVIDENCE_DIR" "$TARGET_DIR"
